{% extends "base.html" %}
{% load static %}
{% load filters %}

{% block title %}Select Patient to change | PTLD System{% endblock %}

{% block breadcrumbs %}
<a href="{% url 'patients:patient-list' %}">Home</a>
&rsaquo; Patients
{% endblock %}

{% block content %}
<div id="changelist" class="module filtered">
    <div id="changelist-filter">
        <h2>Filter</h2>
        
        <h3>By Sex</h3>
        <ul class="filter-list">
            <li{% if request.GET.sex == 'M' %} class="selected"{% endif %}>
                <a href="{% build_filter_url sex='M' %}">Male</a>
            </li>
            <li{% if request.GET.sex == 'F' %} class="selected"{% endif %}>
                <a href="{% build_filter_url sex='F' %}">Female</a>
            </li>
            <li{% if not request.GET.sex %} class="selected"{% endif %}>
                <a href="{% build_filter_url sex=None %}">All</a>
            </li>
        </ul>
        
        <h3>By Age Group</h3>
        <ul class="filter-list">
            <li{% if request.GET.age_group == '0_19' %} class="selected"{% endif %}>
                <a href="{% build_filter_url age_group='0_19' %}">0-19</a>
            </li>
            <li{% if request.GET.age_group == '20_29' %} class="selected"{% endif %}>
                <a href="{% build_filter_url age_group='20_29' %}">20-29</a>
            </li>
            <li{% if request.GET.age_group == '30_39' %} class="selected"{% endif %}>
                <a href="{% build_filter_url age_group='30_39' %}">30-39</a>
            </li>
            <li{% if request.GET.age_group == '40_49' %} class="selected"{% endif %}>
                <a href="{% build_filter_url age_group='40_49' %}">40-49</a>
            </li>
            <li{% if request.GET.age_group == '50_59' %} class="selected"{% endif %}>
                <a href="{% build_filter_url age_group='50_59' %}">50-59</a>
            </li>
            <li{% if request.GET.age_group == '60_plus' %} class="selected"{% endif %}>
                <a href="{% build_filter_url age_group='60_plus' %}">60+</a>
            </li>
            <li{% if not request.GET.age_group %} class="selected"{% endif %}>
                <a href="{% build_filter_url age_group=None %}">All</a>
            </li>
        </ul>
        
        <h3>By HIV Status</h3>
        <ul class="filter-list">
            <li{% if request.GET.hiv == '1' %} class="selected"{% endif %}>
                <a href="{% build_filter_url hiv='1' %}">Yes</a>
            </li>
            <li{% if request.GET.hiv == '0' %} class="selected"{% endif %}>
                <a href="{% build_filter_url hiv='0' %}">No</a>
            </li>
            <li{% if not request.GET.hiv %} class="selected"{% endif %}>
                <a href="{% build_filter_url hiv=None %}">All</a>
            </li>
        </ul>
        
        <h3>By Diabetes</h3>
        <ul class="filter-list">
            <li{% if request.GET.diabetes == '1' %} class="selected"{% endif %}>
                <a href="{% build_filter_url diabetes='1' %}">Yes</a>
            </li>
            <li{% if request.GET.diabetes == '0' %} class="selected"{% endif %}>
                <a href="{% build_filter_url diabetes='0' %}">No</a>
            </li>
            <li{% if not request.GET.diabetes %} class="selected"{% endif %}>
                <a href="{% build_filter_url diabetes=None %}">All</a>
            </li>
        </ul>
        
        <h3>By Smoking</h3>
        <ul class="filter-list">
            <li{% if request.GET.smoker == '1' %} class="selected"{% endif %}>
                <a href="{% build_filter_url smoker='1' %}">Yes</a>
            </li>
            <li{% if request.GET.smoker == '0' %} class="selected"{% endif %}>
                <a href="{% build_filter_url smoker='0' %}">No</a>
            </li>
            <li{% if not request.GET.smoker %} class="selected"{% endif %}>
                <a href="{% build_filter_url smoker=None %}">All</a>
            </li>
        </ul>
        
        <h3>By AIDS</h3>
        <ul class="filter-list">
            <li{% if request.GET.aids == '1' %} class="selected"{% endif %}>
                <a href="{% build_filter_url aids='1' %}">Yes</a>
            </li>
            <li{% if request.GET.aids == '0' %} class="selected"{% endif %}>
                <a href="{% build_filter_url aids='0' %}">No</a>
            </li>
            <li{% if not request.GET.aids %} class="selected"{% endif %}>
                <a href="{% build_filter_url aids=None %}">All</a>
            </li>
        </ul>
        
        <h3>By Alcoholism</h3>
        <ul class="filter-list">
            <li{% if request.GET.alcoholism == '1' %} class="selected"{% endif %}>
                <a href="{% build_filter_url alcoholism='1' %}">Yes</a>
            </li>
            <li{% if request.GET.alcoholism == '0' %} class="selected"{% endif %}>
                <a href="{% build_filter_url alcoholism='0' %}">No</a>
            </li>
            <li{% if not request.GET.alcoholism %} class="selected"{% endif %}>
                <a href="{% build_filter_url alcoholism=None %}">All</a>
            </li>
        </ul>
        
        <h3>By Mental Disorder</h3>
        <ul class="filter-list">
            <li{% if request.GET.mental_disorder == '1' %} class="selected"{% endif %}>
                <a href="{% build_filter_url mental_disorder='1' %}">Yes</a>
            </li>
            <li{% if request.GET.mental_disorder == '0' %} class="selected"{% endif %}>
                <a href="{% build_filter_url mental_disorder='0' %}">No</a>
            </li>
            <li{% if not request.GET.mental_disorder %} class="selected"{% endif %}>
                <a href="{% build_filter_url mental_disorder=None %}">All</a>
            </li>
        </ul>
        
        <h3>By Drug Addiction</h3>
        <ul class="filter-list">
            <li{% if request.GET.drug_addiction == '1' %} class="selected"{% endif %}>
                <a href="{% build_filter_url drug_addiction='1' %}">Yes</a>
            </li>
            <li{% if request.GET.drug_addiction == '0' %} class="selected"{% endif %}>
                <a href="{% build_filter_url drug_addiction='0' %}">No</a>
            </li>
            <li{% if not request.GET.drug_addiction %} class="selected"{% endif %}>
                <a href="{% build_filter_url drug_addiction=None %}">All</a>
            </li>
        </ul>
        
        <h3>By State</h3>
        <ul class="filter-list">
            {% for state_val in states %}
            <li{% if request.GET.state == state_val %} class="selected"{% endif %}>
                <a href="{% build_filter_url state=state_val %}">{{ state_val }}</a>
            </li>
            {% empty %}
            <li><span class="quiet">No states available</span></li>
            {% endfor %}
            <li{% if not request.GET.state %} class="selected"{% endif %}>
                <a href="{% build_filter_url state=None %}">All</a>
            </li>
        </ul>
        
        <h3>By Outcome Status</h3>
        <ul class="filter-list">
            {% for value, label in outcome_choices %}
            <li{% if request.GET.outcome == value %} class="selected"{% endif %}>
                <a href="{% build_filter_url outcome=value %}">{{ label }}</a>
            </li>
            {% endfor %}
            <li{% if not request.GET.outcome %} class="selected"{% endif %}>
                <a href="{% build_filter_url outcome=None %}">All</a>
            </li>
        </ul>
        
        <h3>By Clinical Form</h3>
        <ul class="filter-list">
            {% for form_val in clinical_forms %}
            <li{% if request.GET.clinical_form == form_val %} class="selected"{% endif %}>
                <a href="{% build_filter_url clinical_form=form_val %}">{{ form_val }}</a>
            </li>
            {% empty %}
            <li><span class="quiet">No forms available</span></li>
            {% endfor %}
            <li{% if not request.GET.clinical_form %} class="selected"{% endif %}>
                <a href="{% build_filter_url clinical_form=None %}">All</a>
            </li>
        </ul>
        
        <h3>By Supervised Treatment</h3>
        <ul class="filter-list">
            <li{% if request.GET.supervised == '1' %} class="selected"{% endif %}>
                <a href="{% build_filter_url supervised='1' %}">Yes</a>
            </li>
            <li{% if request.GET.supervised == '0' %} class="selected"{% endif %}>
                <a href="{% build_filter_url supervised='0' %}">No</a>
            </li>
            <li{% if not request.GET.supervised %} class="selected"{% endif %}>
                <a href="{% build_filter_url supervised=None %}">All</a>
            </li>
        </ul>
        
        <h3>Bacilloscopy Month 3 ⭐</h3>
        <ul class="filter-list">
            <li{% if request.GET.bacillo_m3 == 'positive' %} class="selected"{% endif %}>
                <a href="{% build_filter_url bacillo_m3='positive' %}">Positive</a>
            </li>
            <li{% if request.GET.bacillo_m3 == 'negative' %} class="selected"{% endif %}>
                <a href="{% build_filter_url bacillo_m3='negative' %}">Negative</a>
            </li>
            <li{% if not request.GET.bacillo_m3 %} class="selected"{% endif %}>
                <a href="{% build_filter_url bacillo_m3=None %}">All</a>
            </li>
        </ul>
        
        <h3>Bacilloscopy Month 4 ⭐</h3>
        <ul class="filter-list">
            <li{% if request.GET.bacillo_m4 == 'positive' %} class="selected"{% endif %}>
                <a href="{% build_filter_url bacillo_m4='positive' %}">Positive</a>
            </li>
            <li{% if request.GET.bacillo_m4 == 'negative' %} class="selected"{% endif %}>
                <a href="{% build_filter_url bacillo_m4='negative' %}">Negative</a>
            </li>
            <li{% if not request.GET.bacillo_m4 %} class="selected"{% endif %}>
                <a href="{% build_filter_url bacillo_m4=None %}">All</a>
            </li>
        </ul>
        
        <h3>By Rifampicin</h3>
        <ul class="filter-list">
            <li{% if request.GET.rifampicin == '1' %} class="selected"{% endif %}>
                <a href="{% build_filter_url rifampicin='1' %}">Yes</a>
            </li>
            <li{% if request.GET.rifampicin == '0' %} class="selected"{% endif %}>
                <a href="{% build_filter_url rifampicin='0' %}">No</a>
            </li>
            <li{% if not request.GET.rifampicin %} class="selected"{% endif %}>
                <a href="{% build_filter_url rifampicin=None %}">All</a>
            </li>
        </ul>
        
        <h3>By Isoniazid</h3>
        <ul class="filter-list">
            <li{% if request.GET.isoniazid == '1' %} class="selected"{% endif %}>
                <a href="{% build_filter_url isoniazid='1' %}">Yes</a>
            </li>
            <li{% if request.GET.isoniazid == '0' %} class="selected"{% endif %}>
                <a href="{% build_filter_url isoniazid='0' %}">No</a>
            </li>
            <li{% if not request.GET.isoniazid %} class="selected"{% endif %}>
                <a href="{% build_filter_url isoniazid=None %}">All</a>
            </li>
        </ul>
        
        <h3>By Ethambutol</h3>
        <ul class="filter-list">
            <li{% if request.GET.ethambutol == '1' %} class="selected"{% endif %}>
                <a href="{% build_filter_url ethambutol='1' %}">Yes</a>
            </li>
            <li{% if request.GET.ethambutol == '0' %} class="selected"{% endif %}>
                <a href="{% build_filter_url ethambutol='0' %}">No</a>
            </li>
            <li{% if not request.GET.ethambutol %} class="selected"{% endif %}>
                <a href="{% build_filter_url ethambutol=None %}">All</a>
            </li>
        </ul>
        
        <h3>By Treatment Status</h3>
        <ul class="filter-list">
            <li{% if request.GET.treated_before == '1' %} class="selected"{% endif %}>
                <a href="{% build_filter_url treated_before='1' %}">Treated Before</a>
            </li>
            <li{% if request.GET.treated_before == '0' %} class="selected"{% endif %}>
                <a href="{% build_filter_url treated_before='0' %}">Not Treated</a>
            </li>
            <li{% if not request.GET.treated_before %} class="selected"{% endif %}>
                <a href="{% build_filter_url treated_before=None %}">All</a>
            </li>
        </ul>
        
        <h3>By Regimen Change</h3>
        <ul class="filter-list">
            <li{% if request.GET.regimen_change == '1' %} class="selected"{% endif %}>
                <a href="{% build_filter_url regimen_change='1' %}">Has Changes</a>
            </li>
            <li{% if request.GET.regimen_change == '0' %} class="selected"{% endif %}>
                <a href="{% build_filter_url regimen_change='0' %}">No Changes</a>
            </li>
            <li{% if not request.GET.regimen_change %} class="selected"{% endif %}>
                <a href="{% build_filter_url regimen_change=None %}">All</a>
            </li>
        </ul>
        
        {% if request.GET.search or request.GET.sex or request.GET.hiv or request.GET.diabetes or request.GET.smoker or request.GET.age_group or request.GET.treated_before or request.GET.regimen_change or request.GET.aids or request.GET.alcoholism or request.GET.mental_disorder or request.GET.drug_addiction or request.GET.state or request.GET.outcome or request.GET.clinical_form or request.GET.supervised or request.GET.bacillo_m3 or request.GET.bacillo_m4 or request.GET.rifampicin or request.GET.isoniazid or request.GET.ethambutol %}
        <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #ddd;">
            <a href="{% url 'patients:patient-list' %}" class="button" style="display: block; text-align: center; padding: 8px;">Clear All Filters</a>
        </div>
        {% endif %}
    </div>
    
    <div id="changelist-form">
        <form id="changelist-search" method="get">
            <div>
                <label for="searchbar"><img src="{% static 'admin/img/search.svg' %}" alt="Search"></label>
                <input type="text" size="40" name="search" value="{{ request.GET.search }}" id="searchbar" autofocus placeholder="Search by Patient ID or State...">
                <input type="submit" value="Search">
                {% if request.GET.search or request.GET.sex or request.GET.hiv or request.GET.diabetes or request.GET.smoker or request.GET.age_group or request.GET.treated_before or request.GET.regimen_change or request.GET.aids or request.GET.alcoholism or request.GET.mental_disorder or request.GET.drug_addiction or request.GET.state or request.GET.outcome or request.GET.clinical_form or request.GET.supervised or request.GET.bacillo_m3 or request.GET.bacillo_m4 or request.GET.rifampicin or request.GET.isoniazid or request.GET.ethambutol %}
                <a href="{% url 'patients:patient-list' %}" class="small quiet" style="margin-left: 10px;">Clear all filters</a>
                {% endif %}
            </div>
        </form>
        
        <form id="changelist-form" method="post" novalidate>
            {% csrf_token %}
            <div class="results">
                <table id="result_list">
                    <thead>
                        <tr>
                            <th scope="col" class="sortable column-patient_id">
                                <div class="text"><a href="?o=1">Patient ID</a></div>
                                <div class="clear"></div>
                            </th>
                            <th scope="col" class="sortable column-notification_date">
                                <div class="text">Notification Date</div>
                                <div class="clear"></div>
                            </th>
                            <th scope="col" class="sortable column-sex">
                                <div class="text"><a href="?o=2">Sex</a></div>
                                <div class="clear"></div>
                            </th>
                            <th scope="col" class="sortable column-age">
                                <div class="text"><a href="?o=3">Age</a></div>
                                <div class="clear"></div>
                            </th>
                            <th scope="col" class="sortable column-race">
                                <div class="text">Race</div>
                                <div class="clear"></div>
                            </th>
                            <th scope="col" class="sortable column-state">
                                <div class="text">State</div>
                                <div class="clear"></div>
                            </th>
                            <th scope="col" class="sortable column-treatment">
                                <div class="text">Treatment</div>
                                <div class="clear"></div>
                            </th>
                            <th scope="col" class="sortable column-clinical_form">
                                <div class="text">Clinical Form</div>
                                <div class="clear"></div>
                            </th>
                            <th scope="col" class="sortable column-chest_x_ray">
                                <div class="text">Chest X-Ray</div>
                                <div class="clear"></div>
                            </th>
                            <th scope="col" class="sortable column-tuberculin_test">
                                <div class="text">Tuberculin Test</div>
                                <div class="clear"></div>
                            </th>
                            <th scope="col" class="sortable column-hiv">
                                <div class="text">HIV</div>
                                <div class="clear"></div>
                            </th>
                            <th scope="col" class="sortable column-aids">
                                <div class="text">AIDS</div>
                                <div class="clear"></div>
                            </th>
                            <th scope="col" class="sortable column-diabetes">
                                <div class="text">Diabetes</div>
                                <div class="clear"></div>
                            </th>
                            <th scope="col" class="sortable column-smoking">
                                <div class="text">Smoking</div>
                                <div class="clear"></div>
                            </th>
                            <th scope="col" class="sortable column-alcoholism">
                                <div class="text">Alcoholism</div>
                                <div class="clear"></div>
                            </th>
                            <th scope="col" class="sortable column-mental_disorder">
                                <div class="text">Mental Disorder</div>
                                <div class="clear"></div>
                            </th>
                            <th scope="col" class="sortable column-drug_addiction">
                                <div class="text">Drug Addiction</div>
                                <div class="clear"></div>
                            </th>
                            <th scope="col" class="sortable column-bacilloscopy_sputum">
                                <div class="text">Bacilloscopy Sputum</div>
                                <div class="clear"></div>
                            </th>
                            <th scope="col" class="sortable column-sputum_culture">
                                <div class="text">Sputum Culture</div>
                                <div class="clear"></div>
                            </th>
                            <th scope="col" class="sortable column-bacilloscopy_month_3">
                                <div class="text">Bacilloscopy M3 ⭐</div>
                                <div class="clear"></div>
                            </th>
                            <th scope="col" class="sortable column-bacilloscopy_month_4">
                                <div class="text">Bacilloscopy M4 ⭐</div>
                                <div class="clear"></div>
                            </th>
                            <th scope="col" class="sortable column-rifampicin">
                                <div class="text">Rifampicin</div>
                                <div class="clear"></div>
                            </th>
                            <th scope="col" class="sortable column-isoniazid">
                                <div class="text">Isoniazid</div>
                                <div class="clear"></div>
                            </th>
                            <th scope="col" class="sortable column-ethambutol">
                                <div class="text">Ethambutol</div>
                                <div class="clear"></div>
                            </th>
                            <th scope="col" class="sortable column-supervised_treatment">
                                <div class="text">Supervised Treatment</div>
                                <div class="clear"></div>
                            </th>
                            <th scope="col" class="sortable column-occupational_disease">
                                <div class="text">Occupational Disease</div>
                                <div class="clear"></div>
                            </th>
                            <th scope="col" class="sortable column-days_in_treatment">
                                <div class="text">Days In Treatment</div>
                                <div class="clear"></div>
                            </th>
                            <th scope="col" class="sortable column-outcome_status">
                                <div class="text">Outcome Status</div>
                                <div class="clear"></div>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for patient in patients %}
                        <tr class="{% cycle 'row1' 'row2' %}">
                            <th class="field-patient_id">
                                <a href="{% url 'patients:patient-detail' patient.patient_id %}">{{ patient.patient_id }}</a>
                            </th>
                            <td class="field-notification_date">
                                {% if patient.notification_date %}{{ patient.notification_date|date:"Y-m-d" }}{% else %}<span class="quiet">-</span>{% endif %}
                            </td>
                            <td class="field-sex">{{ patient.sex }}</td>
                            <td class="field-age">{{ patient.age }}</td>
                            <td class="field-race">{{ patient.race|default:"-" }}</td>
                            <td class="field-state">{{ patient.state|default:"-" }}</td>
                            <td class="field-treatment">{{ patient.treatment|default:"-" }}</td>
                            <td class="field-clinical_form">{{ patient.clinical_form|default:"-" }}</td>
                            <td class="field-chest_x_ray">{{ patient.chest_x_ray|default:"-" }}</td>
                            <td class="field-tuberculin_test">{{ patient.tuberculin_test|default:"-" }}</td>
                            <td class="field-hiv">
                                {% if patient.hiv_positive %}
                                    <img src="{% static 'admin/img/icon-yes.svg' %}" alt="Yes" title="HIV Positive">
                                {% else %}
                                    <img src="{% static 'admin/img/icon-no.svg' %}" alt="No" title="HIV Negative">
                                {% endif %}
                            </td>
                            <td class="field-aids">
                                {% if patient.aids_comorbidity %}
                                    <img src="{% static 'admin/img/icon-yes.svg' %}" alt="Yes" title="AIDS Comorbidity">
                                {% else %}
                                    <img src="{% static 'admin/img/icon-no.svg' %}" alt="No" title="No AIDS">
                                {% endif %}
                            </td>
                            <td class="field-diabetes">
                                {% if patient.diabetes %}
                                    <img src="{% static 'admin/img/icon-yes.svg' %}" alt="Yes" title="Has Diabetes">
                                {% else %}
                                    <img src="{% static 'admin/img/icon-no.svg' %}" alt="No" title="No Diabetes">
                                {% endif %}
                            </td>
                            <td class="field-smoking">
                                {% if patient.smoker %}
                                    <img src="{% static 'admin/img/icon-yes.svg' %}" alt="Yes" title="Smoker">
                                {% else %}
                                    <img src="{% static 'admin/img/icon-no.svg' %}" alt="No" title="Non-smoker">
                                {% endif %}
                            </td>
                            <td class="field-alcoholism">
                                {% if patient.alcoholism_comorbidity %}
                                    <img src="{% static 'admin/img/icon-yes.svg' %}" alt="Yes" title="Alcoholism Comorbidity">
                                {% else %}
                                    <img src="{% static 'admin/img/icon-no.svg' %}" alt="No" title="No Alcoholism">
                                {% endif %}
                            </td>
                            <td class="field-mental_disorder">
                                {% if patient.mental_disorder_comorbidity %}
                                    <img src="{% static 'admin/img/icon-yes.svg' %}" alt="Yes" title="Mental Disorder Comorbidity">
                                {% else %}
                                    <img src="{% static 'admin/img/icon-no.svg' %}" alt="No" title="No Mental Disorder">
                                {% endif %}
                            </td>
                            <td class="field-drug_addiction">
                                {% if patient.drug_addiction_comorbidity %}
                                    <img src="{% static 'admin/img/icon-yes.svg' %}" alt="Yes" title="Drug Addiction Comorbidity">
                                {% else %}
                                    <img src="{% static 'admin/img/icon-no.svg' %}" alt="No" title="No Drug Addiction">
                                {% endif %}
                            </td>
                            <td class="field-bacilloscopy_sputum">{{ patient.bacilloscopy_sputum|default:"-" }}</td>
                            <td class="field-sputum_culture">{{ patient.sputum_culture|default:"-" }}</td>
                            <td class="field-bacilloscopy_month_3" style="background: #e7f3ff;">
                                <strong>{{ patient.bacilloscopy_month_3|default:"-" }}</strong>
                            </td>
                            <td class="field-bacilloscopy_month_4" style="background: #e7f3ff;">
                                <strong>{{ patient.bacilloscopy_month_4|default:"-" }}</strong>
                            </td>
                            <td class="field-rifampicin">
                                {% if patient.rifampicin %}
                                    <img src="{% static 'admin/img/icon-yes.svg' %}" alt="Yes">
                                {% else %}
                                    <img src="{% static 'admin/img/icon-no.svg' %}" alt="No">
                                {% endif %}
                            </td>
                            <td class="field-isoniazid">
                                {% if patient.isoniazid %}
                                    <img src="{% static 'admin/img/icon-yes.svg' %}" alt="Yes">
                                {% else %}
                                    <img src="{% static 'admin/img/icon-no.svg' %}" alt="No">
                                {% endif %}
                            </td>
                            <td class="field-ethambutol">
                                {% if patient.ethambutol %}
                                    <img src="{% static 'admin/img/icon-yes.svg' %}" alt="Yes">
                                {% else %}
                                    <img src="{% static 'admin/img/icon-no.svg' %}" alt="No">
                                {% endif %}
                            </td>
                            <td class="field-supervised_treatment">
                                {% if patient.supervised_treatment %}
                                    <img src="{% static 'admin/img/icon-yes.svg' %}" alt="Yes" title="Supervised Treatment">
                                {% else %}
                                    <img src="{% static 'admin/img/icon-no.svg' %}" alt="No" title="Not Supervised">
                                {% endif %}
                            </td>
                            <td class="field-occupational_disease">
                                {% if patient.occupational_disease %}
                                    <img src="{% static 'admin/img/icon-yes.svg' %}" alt="Yes" title="Occupational Disease">
                                {% else %}
                                    <img src="{% static 'admin/img/icon-no.svg' %}" alt="No" title="Not Occupational">
                                {% endif %}
                            </td>
                            <td class="field-days_in_treatment">{{ patient.days_in_treatment|default:"-" }}</td>
                            <td class="field-outcome_status">
                                {% if patient.outcome_status %}
                                    <strong>{{ patient.get_outcome_status_display|default:patient.outcome_status }}</strong>
                                {% else %}
                                    <span class="quiet">-</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% empty %}
                        <tr class="row1">
                            <td colspan="28" class="text-center">
                                <p class="errornote">No patients found.</p>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            
            <p class="paginator">
                {% if page_obj.has_previous %}
                    <a href="{% build_filter_url page=1 %}">&laquo; first</a>
                    <a href="{% build_filter_url page=page_obj.previous_page_number %}">previous</a>
                {% endif %}
                
                <span class="this-page">
                    Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
                </span>
                
                {% if page_obj.has_next %}
                    <a href="{% build_filter_url page=page_obj.next_page_number %}">next</a>
                    <a href="{% build_filter_url page=page_obj.paginator.num_pages %}">last &raquo;</a>
                {% endif %}
                
                {{ page_obj.paginator.count }} patient{{ page_obj.paginator.count|pluralize }}
            </p>
        </form>
    </div>
</div>

{% if user.role == 'clinician' or user.role == 'admin' %}
<ul class="object-tools">
    <li>
        <a href="{% url 'patients:patient-create' %}" class="addlink">
            Add patient
        </a>
    </li>
</ul>
{% endif %}

<style>
/* Django Admin Changelist Styles */
#changelist {
    position: relative;
    background: #fff;
    border: 1px solid #ddd;
    margin-left: 0;
}

#changelist-filter {
    position: absolute;
    right: 0;
    top: 0;
    width: 220px;
    background: #f8f9fa;
    border-left: 1px solid #ddd;
    padding: 10px;
    font-size: 12px;
    min-height: 100%;
    max-height: 100vh;
    overflow-y: auto;
    z-index: 10;
}

#changelist-filter h2 {
    font-size: 13px;
    font-weight: 600;
    margin: 0 0 10px 0;
    padding: 0;
    color: #666;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

#changelist-filter h3 {
    font-size: 12px;
    font-weight: 600;
    margin: 15px 0 5px 0;
    padding: 0;
    color: #333;
}

#changelist-filter .filter-list {
    list-style: none;
    padding: 0;
    margin: 0 0 15px 0;
}

#changelist-filter .filter-list li {
    padding: 3px 0;
}

#changelist-filter .filter-list li.selected {
    background: #417690;
    margin: 0 -10px;
    padding: 3px 10px;
}

#changelist-filter .filter-list li.selected a {
    color: #fff;
    font-weight: 600;
}

#changelist-filter .filter-list a {
    color: #417690;
    text-decoration: none;
    display: block;
    padding: 2px 0;
}

#changelist-filter .filter-list a:hover {
    text-decoration: underline;
}

#changelist-form {
    margin-right: 220px;
    position: relative;
    overflow-x: auto;
}

#changelist-search {
    padding: 10px;
    background: #fff;
    border-bottom: 1px solid #ddd;
}

#changelist-search > div {
    display: flex;
    align-items: center;
    gap: 10px;
}

#changelist-search label {
    display: inline-block;
}

#changelist-search label img {
    vertical-align: middle;
}

#changelist-search input[type="text"] {
    width: 300px;
    padding: 6px 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 13px;
}

#changelist-search input[type="submit"] {
    padding: 6px 15px;
    background: #417690;
    color: #fff;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 13px;
}

#changelist-search input[type="submit"]:hover {
    background: #205067;
}

#changelist-search .quiet {
    color: #ba2121;
    text-decoration: none;
    font-size: 11px;
}

#changelist-search .quiet:hover {
    text-decoration: underline;
}

.results {
    overflow-x: auto;
    max-width: 100%;
}

#result_list {
    width: 100%;
    min-width: 100%;
    border-collapse: collapse;
    font-size: 11px;
    table-layout: auto;
}

#result_list thead th {
    background: #f5f5f5;
    padding: 6px 8px;
    text-align: left;
    font-weight: 600;
    border-bottom: 1px solid #ddd;
    white-space: nowrap;
    font-size: 11px;
}

#result_list thead th.sortable {
    background: #f5f5f5;
    padding-right: 25px;
    position: relative;
}
#result_list thead th.sortable::after {
    content: "⇅";
    position: absolute;
    right: 8px;
    top: 50%;
    transform: translateY(-50%);
    color: #417690;
    font-size: 10px;
}

#result_list thead th.sortable .text a {
    color: #417690;
    text-decoration: none;
}

#result_list thead th.sortable .text a:hover {
    color: #205067;
}

#result_list tbody tr.row1 {
    background: #fff;
}

#result_list tbody tr.row2 {
    background: #f9f9f9;
}

#result_list tbody tr:hover {
    background: #f0f0f0;
}

#result_list tbody th,
#result_list tbody td {
    padding: 6px 8px;
    border-bottom: 1px solid #eee;
    font-size: 11px;
    white-space: nowrap;
}

#result_list tbody th {
    font-weight: 600;
}

#result_list tbody th a {
    color: #417690;
    text-decoration: none;
}

#result_list tbody th a:hover {
    text-decoration: underline;
}

#result_list tbody td img {
    vertical-align: middle;
}

.quiet {
    color: #999;
    font-style: italic;
}

.paginator {
    padding: 10px;
    background: #fff;
    border-top: 1px solid #ddd;
    text-align: center;
    font-size: 13px;
    color: #666;
}

.paginator a {
    color: #417690;
    text-decoration: none;
    margin: 0 5px;
}

.paginator a:hover {
    text-decoration: underline;
}

.paginator .this-page {
    margin: 0 10px;
    font-weight: 600;
}

.object-tools {
    list-style: none;
    padding: 0;
    margin: 0 0 20px 0;
    float: right;
}

.object-tools li {
    float: left;
    margin-left: 5px;
}

.object-tools .addlink {
    background: #417690;
    padding: 10px 12px 10px 28px;
    color: #fff;
    text-decoration: none;
    border-radius: 4px;
    font-size: 13px;
    font-weight: 400;
    position: relative;
}
.object-tools .addlink::before {
    content: "+";
    position: absolute;
    left: 10px;
    font-size: 16px;
    font-weight: bold;
}

.object-tools .addlink:hover {
    background-color: #205067;
}

.errornote {
    padding: 10px;
    color: #ba2121;
    background: #fff;
    border: 1px solid #ba2121;
    border-radius: 4px;
    margin: 10px 0;
}

.clear {
    clear: both;
}
</style>
{% endblock %}
